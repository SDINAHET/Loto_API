<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©sultats Loto</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="loto_tracker.png">


    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment/min/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment-timezone/builds/moment-timezone-with-data.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        .lottery-ball {
            display: inline-block;
            width: 40px;
            height: 40px;
            line-height: 40px;
            border-radius: 50%;
            background: blue;
            color: white;
            text-align: center;
            font-weight: bold;
            margin: 5px;
        }
        .lucky-number {
            background: red;
        }
        .card-lottery {
            margin: 10px;
        }
        .logo {
            width: 120px;
            height: 120px;
        }

        .header {
            background-color: #212529;
            padding: 10px 20px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 24px;
            font-weight: bold;
        }
        /* üìå Conteneur principal du compte √† rebours */
        .countdown-container {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3.5rem;
            font-weight: bold;
            color: #ffeb3b;
            text-shadow: 4px 4px 12px rgba(255, 215, 0, 1);
            padding: 20px;
            border-radius: 15px;
            background: linear-gradient(135deg, rgba(255, 87, 34, 0.95), rgba(255, 193, 7, 0.95));
            box-shadow: 0px 0px 25px rgba(255, 87, 34, 0.8);
            text-align: center;
            width: fit-content;
            margin: auto;
            position: relative;
            overflow: hidden;
            animation: glow 2s infinite alternate, bounce 2s infinite ease-in-out;
        }

        /* üåÄ Arri√®re-plan anim√© avec GIF scintillant */
        .countdown-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://media.giphy.com/media/3o6Zt481isNVuQI1l6/giphy.gif') no-repeat center center;
            background-size: cover;
            opacity: 0.3;
            z-index: -1;
        }

        /* üî• Ajout d‚Äôun coq dansant üêì */
        .countdown-container::after {
            content: "üêì";
            position: absolute;
            font-size: 4rem;
            top: -20px;
            right: 10px;
            animation: coqFlap 1s infinite alternate;
        }

        /* üï∫ Animation du coq */
        @keyframes coqFlap {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(10deg); }
        }

        /* üêá Ajout d‚Äôun lapin ultra-rapide */
        .lapin {
            position: absolute;
            left: -50px;
            bottom: 0;
            font-size: 3.5rem;
           animation: lapinJump 2s infinite ease-in-out;
        }

        /* üê∞ Animation du lapin bondissant */
        @keyframes lapinJump {
            0%, 100% { left: -50px; bottom: 0; }
            50% { left: 50%; bottom: 80px; }
        }

        /* üé° Roue de la fortune ultra-dynamique */
        .roulette {
            position: absolute;
            right: 10px;
            bottom: 10px;
            font-size: 5rem;
            animation: spinRoulette 3s infinite linear;
        }

        /* üî• Animation de rotation rapide */
        @keyframes spinRoulette {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* üéá Ajout de confettis GIF */
        .confetti {
            position: absolute;
            width: 100%;
            height: 100%;
            background: url('https://media.giphy.com/media/3oz8xWz8boEEUXNwhW/giphy.gif') no-repeat center center;
            background-size: cover;
            opacity: 0.3;
            z-index: -1;
        }

        /* üéÜ Effet lumineux pour chaque chiffre */
        .countdown-container span {
            display: inline-block;
            transition: transform 0.3s ease-in-out, color 0.3s ease-in-out;
            font-size: 4rem;
            font-weight: bold;
            padding: 10px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            color: #ffffff;
            text-shadow: 4px 4px 12px rgba(255, 215, 0, 1);
            animation: flash 1s infinite alternate, fireGlow 1.5s infinite ease-in-out;
        }

        /* üî• Animation scintillante */
        @keyframes flash {
            0% { color: #ffeb3b; text-shadow: 5px 5px 20px rgba(255, 215, 0, 1); }
            100% { color: #ffffff; text-shadow: 5px 5px 30px rgba(255, 193, 7, 1); }
        }

        /* üî• Ajout d‚Äôun effet de flammes */
        @keyframes fireGlow {
            0% { box-shadow: 0px 0px 10px rgba(255, 87, 34, 0.7); }
            100% { box-shadow: 0px 0px 25px rgba(255, 193, 7, 1); }
        }

        /* üîÑ Effet de vibration des secondes */
        .countdown-container span:nth-child(5) {
            animation: shake 1s infinite;
        }

        /* üî• Animation de secousse */
        @keyframes shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
            75% { transform: rotate(-5deg); }
            100% { transform: rotate(5deg); }
        }

        /* üé± Boules anim√©es en fond */
        .boule {
            position: absolute;
            bottom: -50px;
            width: 60px;
            height: 60px;
            background-color: gold;
            border-radius: 50%;
            box-shadow: 0px 0px 15px rgba(255, 215, 0, 1);
            animation: roll 6s infinite linear;
        }

        /* üèÄ Animation des boules en mouvement */
        @keyframes roll {
            0% { left: 0; bottom: -50px; }
            50% { left: 50%; bottom: 120px; }
            100% { left: 100%; bottom: -50px; }
        }





    </style>
</head>
<body class="bg-light">
    <!-- HEADER -->
    <header class="header d-flex justify-content-between align-items-center p-3 bg-dark text-white">
        <div class="d-flex align-items-center">
            <img src="loto_tracker.png" alt="Logo Loto" class="logo">
            <h1 class="m-0 ms-2">Tracker du Loto Fran√ßais</h1>
        </div>
        <button class="btn btn-outline-light">
            <i class="fas fa-user"></i> Se connecter
        </button>
    </header>
    <div class="container mt-4">
        <h1 class="text-center">R√©sultats du Loto</h1>
        <p class="text-center" id="current-time"></p>
        <div class="text-center my-3">
            <h2>Prochain tirage dans :
                <span id="countdown" class="countdown-container"></span></h2>
                <!-- <div class="countdown-container"> -->
                    <!-- <span id="days">00</span>j
                    <span id="hours">00</span>h
                    <span id="minutes">00</span>m
                    <span id="seconds">00</span>s -->
                <!-- </div> -->
                <!-- <div class="lapin">üêá</div>
                <div class="roulette">üé°</div>
                <div class="confetti"></div>
                <div class="boule"></div> -->

        </div>
        <div class="text-center my-3">
            <button class="btn btn-lg btn-primary" onclick="showPrediction()">
                üîÆ Voir la pr√©diction du prochain tirage (Version Premium)
            </button>
        </div>

        <!-- Modal Bootstrap -->
        <div class="modal fade" id="predictionModal" tabindex="-1" aria-labelledby="predictionModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="predictionModalLabel">üìä Pr√©diction du prochain tirage</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <h5 class="text-center text-primary">Num√©ros probables :</h5>
                        <div id="predictedNumbers" class="text-center my-3"></div>

                        <h5 class="text-center text-success">Num√©ro Chance probable :</h5>
                        <p class="text-center fs-4" id="predictedChance"></p>

                        <h5 class="text-center mt-4">√âcart-type des num√©ros</h5>
                        <canvas id="stdDevChart"></canvas> <!-- Graphique -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                    </div>
                </div>
            </div>
        </div>
        <br>
        <div class="text-center my-3">
            <h2>Historique des tirages: </h2>
        </div>

        <!-- Modal D√©tail du Tirage
        <div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="detailModalLabel">D√©tail du Tirage</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="modalBody">
                        Chargement...
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                    </div>
                </div>
            </div>
        </div> -->
        <!-- Modal D√©tail du Tirage -->
        <div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl"> <!-- Largeur augment√©e -->
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title fw-bold" id="detailModalLabel">D√©tail du Tirage</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="modalBody">
                        Chargement...
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row row-cols-1 row-cols-md-3 g-4" id="last20"></div>

        <h3 class="mt-4">Rechercher un tirage</h3>
        <div class="input-group mb-3">
            <input type="date" id="startDate" class="form-control">
            <input type="date" id="endDate" class="form-control">
            <button class="btn btn-primary" onclick="searchTirages()">Rechercher</button>
        </div>
        <div id="searchResults" class="row row-cols-1 row-cols-md-3 g-4"></div>
    </div>

    <script>
        function updateTime() {
            document.getElementById('current-time').innerText = 'Heure de Paris : ' + moment().tz("Europe/Paris").format("HH:mm:ss");
        }
        setInterval(updateTime, 1000);
        updateTime();

        function startCountdown() {
            setInterval(() => {
                let now = moment().tz("Europe/Paris");
                let nextDraw = moment().tz("Europe/Paris").add(2, 'days').set({ hour: 20, minute: 0, second: 0 });
                let diff = moment.duration(nextDraw.diff(now));

                // Mise √† jour du texte avec un effet dynamique
                document.getElementById("countdown").innerText =
                    `${diff.days()}j ${diff.hours()}h ${diff.minutes()}m ${diff.seconds()}s`;

            }, 1000);
        }
        startCountdown();


        function getDayName(dateString) {
            let [day, month, year] = dateString.split("/").map(Number);
            let date = new Date(year, month - 1, day);
            let jours = ["Dimanche", "Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi"];
            return jours[date.getDay()];
        }


        async function loadLast20() {
            try {
                let response = await axios.get("http://localhost:8082/api/historique/last20");
                let data = response.data;
                let container = document.getElementById("last20");
                container.innerHTML = "";
                data.forEach(draw => {
                    let dayName = getDayName(draw.dateDeTirage);
                    let card = document.createElement("div");
                    card.className = "col";
                    card.innerHTML = `
                        <div class="card card-lottery text-center">
                            <div class="card-body">
                                <h5>${dayName} ${draw.dateDeTirage}</h5>
                                <div>
                                    <span class="lottery-ball">${draw.boule1}</span>
                                    <span class="lottery-ball">${draw.boule2}</span>
                                    <span class="lottery-ball">${draw.boule3}</span>
                                    <span class="lottery-ball">${draw.boule4}</span>
                                    <span class="lottery-ball">${draw.boule5}</span>
                                    <span class="lottery-ball lucky-number">${draw.numeroChance}</span>
                                </div>
                                <button class="btn btn-outline-primary mt-2" onclick="viewDetails('${draw.dateDeTirage}')">D√©tail du Tirage</button>
                            </div>
                        </div>`;
                    container.appendChild(card);
                });
            } catch (error) {
                console.error("Erreur lors du chargement des derniers tirages", error);
            }
        }
        loadLast20();

        function formatDateForAPI(dateString) {
            if (!dateString.includes("/")) return dateString; // Si la date est d√©j√† dans le bon format, on ne la modifie pas
            let parts = dateString.split("/");
            return `${parts[2]}-${parts[1]}-${parts[0]}`; // Convertit "12/02/2025" ‚Üí "2025-02-12"
        }

        async function viewDetails(date) {
            try {
                let formattedDate = formatDateForAPI(date);
                let apiUrl = `http://localhost:8082/api/historique/last20/Detail/tirage/${formattedDate}`;
                console.log("Requ√™te API vers :", apiUrl);

                let response = await axios.get(apiUrl);
                let data = response.data;

                if (!data) {
                    document.getElementById("modalBody").innerHTML = "<p class='text-center text-warning'>Aucun d√©tail trouv√©.</p>";
                    return;
                }

                // G√©n√©ration du contenu du modal avec un container pour le tri
                let modalContent = `
                    <div class="container-fluid">
                        <h4 class="text-center text-danger fw-bold">R√©sultat Loto du ${data.jourDeTirage} ${data.dateDeTirage}</h4>
                        <div class="row">
                            <div class="col-md-6 text-center">
                                <h5 class="fw-bold">Le tirage</h5>
                                <div id="numbersContainer" class="mb-3">
                                    <span class="lottery-ball">${data.boule1}</span>
                                    <span class="lottery-ball">${data.boule2}</span>
                                    <span class="lottery-ball">${data.boule3}</span>
                                    <span class="lottery-ball">${data.boule4}</span>
                                    <span class="lottery-ball">${data.boule5}</span>
                                    <span class="lottery-ball lucky-number">${data.numeroChance}</span>
                                </div>
                                <button id="toggleSortButton" class="btn btn-outline-primary btn-sm" onclick="toggleSortNumbers(${data.boule1}, ${data.boule2}, ${data.boule3}, ${data.boule4}, ${data.boule5}, ${data.numeroChance})">
                                    Trier les num√©ros
                                </button>
                            </div>
                            <div class="col-md-6 text-center">
                                <h5 class="fw-bold">Second tirage</h5>
                                <div class="mb-3">
                                    <span class="lottery-ball">${data.boule1SecondTirage}</span>
                                    <span class="lottery-ball">${data.boule2SecondTirage}</span>
                                    <span class="lottery-ball">${data.boule3SecondTirage}</span>
                                    <span class="lottery-ball">${data.boule4SecondTirage}</span>
                                    <span class="lottery-ball">${data.boule5SecondTirage}</span>
                                </div>
                            </div>
                        </div>

                        <h5 class="text-center text-primary fw-bold">Jackpot annonc√© : <span class="text-dark"> ${data.rapportDuRang1.toLocaleString()} ‚Ç¨</span></h5>

                        <hr>

                        <h5 class="text-center fw-bold">Rapports du tirage :</h5>
                        <div class="table-responsive">
                            <table class="table table-striped text-center">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Rang</th>
                                        <th></th>
                                        <th>Gagnants</th>
                                        <th>Gain (‚Ç¨)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1</td>
                                        <td>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball red-ball"></span>
                                        </td>
                                        <td><strong>${data.nombreDeGagnantAuRang1}</strong></td>
                                        <td><strong>${data.rapportDuRang1.toLocaleString()} ‚Ç¨</strong></td>
                                    </tr>
                                    <tr>
                                        <td>2</td>
                                        <td>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class=""></span>
                                        </td>
                                        <td><strong>${data.nombreDeGagnantAuRang2}</strong></td>
                                        <td><strong>${data.rapportDuRang2.toLocaleString()} ‚Ç¨</strong></td>
                                    </tr>
                                    <tr>
                                        <td>3</td>
                                        <td>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball red-ball"></span>
                                            <span class=""></span>

                                        </td>
                                        <td><strong>${data.nombreDeGagnantAuRang3}</strong></td>
                                        <td><strong>${data.rapportDuRang3.toLocaleString()} ‚Ç¨</strong></td>
                                    </tr>
                                    <tr>
                                        <td>4</td>
                                        <td>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class=""></span>
                                            <span class=""></span>
                                        </td>
                                        <td><strong>${data.nombreDeGagnantAuRang4}</strong></td>
                                        <td><strong>${data.rapportDuRang4.toLocaleString()} ‚Ç¨</strong></td>
                                    </tr>
                                    <tr>
                                        <td>5</td>
                                        <td>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball red-ball"></span>
                                            <span class=""></span>
                                            <span class=""></span>
                                        </td>
                                        <td><strong>${data.nombreDeGagnantAuRang5}</strong></td>
                                        <td><strong>${data.rapportDuRang5.toLocaleString()} ‚Ç¨</strong></td>
                                    </tr>
                                    <tr>
                                        <td>6</td>
                                        <td>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class=""></span>
                                            <span class=""></span>
                                            <span class=""></span>
                                        </td>
                                        <td><strong>${data.nombreDeGagnantAuRang6}</strong></td>
                                        <td><strong>${data.rapportDuRang6.toLocaleString()} ‚Ç¨</strong></td>
                                    </tr>
                                    <tr>
                                        <td>7</td>
                                        <td>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball red-ball"></span>
                                            <span class=""></span>
                                            <span class=""></span>
                                            <span class=""></span>
                                        </td>
                                        <td><strong>${data.nombreDeGagnantAuRang7}</strong></td>
                                        <td><strong>${data.rapportDuRang7.toLocaleString()} ‚Ç¨</strong></td>
                                    </tr>
                                    <tr>
                                        <td>8</td>
                                        <td>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class="lottery-ball blue-ball"></span>
                                            <span class=""></span>
                                            <span class=""></span>
                                            <span class=""></span>
                                            <span class=""></span>
                                        </td>
                                        <td><strong>${data.nombreDeGagnantAuRang8}</strong></td>
                                        <td><strong>${data.rapportDuRang8.toLocaleString()} ‚Ç¨</strong></td>
                                    </tr>
                                    <tr>
                                        <td>9</td>
                                        <td>
                                            <span class=""></span>
                                            <span class=""></span>
                                            <span class=""></span>
                                            <span class=""></span>
                                            <span class=""></span>
                                            <span class="lottery-ball red-ball"></span>
                                        </td>
                                        <td><strong>${data.nombreDeGagnantAuRang9}</strong></td>
                                        <td><strong>${data.rapportDuRang9.toLocaleString()} ‚Ç¨</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <hr>

                        <h5 class="text-center fw-bold">Joker+ : <span class="text-primary">${data.numeroJokerplus}</span></h5>

                        <hr>
                        <!-- <h5 class="text-center fw-bold">Codes gagnants :</h5> -->
                        <!-- <p class="text-center fw-bold">${data.codesGagnants.replace(/,/g, ", ")}</p> -->
                         <h5 class="text-center fw-bold">Codes gagnants :</h5>
                        <div class="winning-codes-container text-center">
                            ${data.codesGagnants.split(',').map(code =>
                                `<span class="winning-code">${code.trim()}</span>`
                            ).join('')}
                        </div>
                        <style>
                        .lottery-ball {
                            display: inline-block;
                            width: 40px;
                            height: 40px;
                            line-height: 40px;
                            text-align: center;
                            font-size: 1.2em;
                            font-weight: bold;
                            color: white;
                            border-radius: 50%;
                            margin: 5px;
                        }
                        .blue-ball {
                            background-color: #007bff; /* Bleu */
                        }
                        .red-ball {
                            background-color: #dc3545; /* Rouge */
                        }
                        .winning-codes-container {
                            display: flex;
                            flex-wrap: wrap; /* Permet de passer √† la ligne si n√©cessaire */
                            gap: 10px; /* Espacement entre chaque code */
                            justify-content: center; /* Centrage des √©l√©ments */
                        }

                        .winning-code {
                            background-color: orange; /* Fond orange */
                            color: white; /* Texte blanc */
                            padding: 8px 12px; /* Espacement autour du texte */
                            border-radius: 5px; /* Coins arrondis */
                            font-size: 1.1em; /* Ajustement de la taille du texte */
                            font-weight: bold; /* Texte en gras */
                            display: inline-block; /* Emp√™che l'√©largissement */
                        }

                        </style>


                    </div>
                `;

                document.getElementById("modalBody").innerHTML = modalContent;

                let modalElement = document.getElementById('detailModal');
                let modalInstance = new bootstrap.Modal(modalElement);
                modalInstance.show(); // Affichage du modal am√©lior√©

            } catch (error) {
                console.error("Erreur lors de la r√©cup√©ration des d√©tails du tirage", error);
                document.getElementById("modalBody").innerHTML = "<p class='text-center text-danger'>Erreur lors du chargement des d√©tails.</p>";
            }
        }

        // ‚úÖ Fonction pour trier les num√©ros ou les remettre dans l'ordre original
        let isSorted = false;
        function toggleSortNumbers(...numbers) {
            let numeroChance = numbers.pop(); // Extrait le num√©ro chance de la liste
            let sortedNumbers;

            if (!isSorted) {
                sortedNumbers = [...numbers].sort((a, b) => a - b);
                document.getElementById("toggleSortButton").innerText = "Remettre l'ordre original";
            } else {
                sortedNumbers = numbers;
                document.getElementById("toggleSortButton").innerText = "Trier les num√©ros";
            }

            isSorted = !isSorted;

            let sortedHTML = sortedNumbers.map(num => `<span class="lottery-ball">${num}</span>`).join('');
            document.getElementById("numbersContainer").innerHTML = sortedHTML + `<span class="lottery-ball lucky-number">${numeroChance}</span>`;
        }


        document.addEventListener("DOMContentLoaded", function () {
            console.log("‚úÖ DOM charg√©, ex√©cution des scripts...");
            loadLast20();
        });

        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("predictionButton").addEventListener("click", function () {
                let paypalUrl = "https://www.paypal.com/paypalme/TON_COMPTE_PAYPAL/5"; // Remplace par ton lien PayPal

                let confirmation = confirm("Pour acc√©der √† la pr√©diction du prochain tirage, un paiement de 5‚Ç¨ est requis. Voulez-vous continuer ?");
                if (confirmation) {
                    // üîπ Ouvrir PayPal dans un nouvel onglet
                    let paypalWindow = window.open(paypalUrl, "_blank");

                    if (!paypalWindow) {
                        alert("‚ö†Ô∏è Impossible d'ouvrir PayPal. V√©rifiez votre bloqueur de pop-ups.");
                        return;
                    }

                    // üîπ Afficher un message avec un d√©compte sur la page principale
                    let countdownMessage = document.createElement("div");
                    countdownMessage.innerHTML = `<p>üïí Vous √™tes sur PayPal. Retour au tirage dans <span id="countdown">10</span> secondes...</p>`;
                    countdownMessage.style.position = "fixed";
                    countdownMessage.style.top = "20px";
                    countdownMessage.style.left = "50%";
                    countdownMessage.style.transform = "translateX(-50%)";
                    countdownMessage.style.background = "black";
                    countdownMessage.style.color = "white";
                    countdownMessage.style.padding = "10px";
                    countdownMessage.style.borderRadius = "5px";
                    document.body.appendChild(countdownMessage);

                    // üîπ D√©compte avant la fermeture de PayPal et retour au modal
                    let countdown = 10;
                    let countdownInterval = setInterval(() => {
                        countdown--;
                        document.getElementById("countdown").textContent = countdown;
                    }, 1000);

                    setTimeout(() => {
                        clearInterval(countdownInterval);
                        document.body.removeChild(countdownMessage); // Supprimer le message

                        if (!paypalWindow.closed) {
                            paypalWindow.close(); // Ferme la fen√™tre PayPal apr√®s 10 secondes
                        }

                        // ‚úÖ Affichage du modal Bootstrap de pr√©diction
                        let modal = new bootstrap.Modal(document.getElementById("predictionModal"));
                        modal.show();

                    }, 10000);
                }
            });
        });



        /**
        * üìå Fonction `showPrediction`
        * ==========================================
        * R√©cup√®re les pr√©dictions du loto depuis l'API et met √† jour l'affichage :
        * - Affiche les num√©ros probables et le num√©ro chance.
        * - Calcule et affiche l'√©cart-type sous forme de graphique et de texte explicatif.
        * - Ouvre un modal Bootstrap contenant les r√©sultats.
        */
        async function showPrediction() {
            try {
                console.log("üì° R√©cup√©ration des pr√©dictions...");
                let response = await axios.get("http://localhost:8082/api/predictions/latest");
                let data = response.data;

                // üîç V√©rification des donn√©es re√ßues
                if (!data || !Array.isArray(data.probableNumbers) || typeof data.stdDevNumbers !== "object") {
                    showErrorModal("‚ö†Ô∏è Les donn√©es de pr√©diction sont invalides !");
                    return;
                }

                console.log("‚úÖ Donn√©es re√ßues :", data);

                // üì° V√©rification des √©l√©ments HTML avant acc√®s
                let predictedNumbersEl = document.getElementById("predictedNumbers");
                let predictedChanceEl = document.getElementById("predictedChance");
                let stdDevChartEl = document.getElementById("stdDevChart");

                if (!predictedNumbersEl || !predictedChanceEl || !stdDevChartEl) {
                    showErrorModal("‚ùå Un ou plusieurs √©l√©ments du DOM sont introuvables !");
                    return;
                }

                // üî¢ Mise √† jour des num√©ros probables
                predictedNumbersEl.innerHTML = data.probableNumbers
                    .map(num => `<span class="lottery-ball">${num}</span>`)
                    .join('');

                predictedChanceEl.innerHTML = `<span class="lottery-ball lucky-number">${data.probableChance}</span>`;

                // üÜï Suppression de l'ancien graphique s'il existe
                if (window.myChart && typeof window.myChart.destroy === "function") {
                    window.myChart.destroy();
                }

                // üìä Cr√©ation du graphique avec Chart.js
                let ctx = stdDevChartEl.getContext("2d");
                let labels = Object.keys(data.stdDevNumbers);
                let stdDevValues = Object.values(data.stdDevNumbers);

                window.myChart = new Chart(ctx, {
                    type: "bar",
                    data: {
                        labels: labels,
                        datasets: [{
                            label: "√âcart-Type des num√©ros",
                            data: stdDevValues,
                            backgroundColor: "rgba(54, 162, 235, 0.6)",
                            borderColor: "rgba(54, 162, 235, 1)",
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: "üìä Dispersion des Num√©ros Probables (√âcart-Type)",
                                font: { size: 16 }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: "Valeur de l'√âcart-Type",
                                    font: { size: 14 }
                                }
                            }
                        }
                    }
                });

                // ‚úÖ Affichage du modal Bootstrap
                let modal = new bootstrap.Modal(document.getElementById("predictionModal"));
                modal.show();

            } catch (error) {
                console.error("‚ùå Erreur lors de la r√©cup√©ration de la pr√©diction :", error);
                showErrorModal("‚ö†Ô∏è Impossible de charger les pr√©dictions. V√©rifiez votre serveur.");
            }
        }

        // üéØ Ajouter l'event listener UNE SEULE FOIS
        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("predictionButton").addEventListener("click", function () {
                let paypalUrl = "https://www.paypal.com/paypalme/TON_COMPTE_PAYPAL/5"; // Remplace par ton lien PayPal

                let confirmation = confirm("Pour acc√©der √† la pr√©diction du prochain tirage, un paiement de 5‚Ç¨ est requis. Voulez-vous continuer ?");
                if (confirmation) {
                    window.location.href = paypalUrl;

                    // üö® Mieux vaut g√©rer la redirection via PayPal plut√¥t qu'un setTimeout !
                    setTimeout(() => {
                        window.location.href = "prediction.html"; // Remplace par l'URL r√©elle de la page de pr√©diction
                    }, 10000);
                }
            });
        });




    </script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>




