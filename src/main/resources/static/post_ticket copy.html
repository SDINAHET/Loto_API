<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajouter un Ticket</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        .number-circle {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 5px;
            cursor: pointer;
            background-color: #bbb;
            color: white;
        }
        .selected {
            background-color: blue !important;
        }
        .chance-circle {
            background-color: #8a0000;
        }
        .chance-circle.selected {
            background-color: red !important;
        }
    </style>
</head>
<body class="bg-light">

<div class="container mt-5">
    <h2 class="text-center">Ajouter un Ticket</h2>

    <div id="numberSelection" class="d-flex flex-wrap justify-content-center">
        <!-- Numéros de 1 à 49 générés en JS -->
    </div>

    <h6 class="mt-3">Numéro Chance :</h6>
    <div id="chanceSelection" class="d-flex flex-wrap justify-content-center">
        <!-- Numéros de 1 à 10 générés en JS -->
    </div>

    <button class="btn btn-success w-100 mt-3" onclick="submitTicket()">Enregistrer</button>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    generateNumbers();
});

// ✅ Générer les numéros 1-49 et 1-10
function generateNumbers() {
    let numberContainer = document.getElementById("numberSelection");
    let chanceContainer = document.getElementById("chanceSelection");

    for (let i = 1; i <= 49; i++) {
        let numBtn = document.createElement("span");
        numBtn.classList.add("number-circle");
        numBtn.textContent = i;
        numBtn.onclick = function () { toggleSelection(numBtn, 5); };
        numberContainer.appendChild(numBtn);
    }

    for (let i = 1; i <= 10; i++) {
        let chanceBtn = document.createElement("span");
        chanceBtn.classList.add("number-circle", "chance-circle");
        chanceBtn.textContent = i;
        chanceBtn.onclick = function () { toggleSelection(chanceBtn, 1); };
        chanceContainer.appendChild(chanceBtn);
    }
}

// ✅ Sélectionner/Désélectionner un numéro
function toggleSelection(btn, limit) {
    let selected = btn.parentNode.querySelectorAll(".selected");
    if (selected.length >= limit && !btn.classList.contains("selected")) return;
    btn.classList.toggle("selected");
}

// ✅ Envoyer le ticket et revenir
async function submitTicket() {
    let numbers = [...document.querySelectorAll("#numberSelection .selected")].map(e => e.textContent).join("-");
    let chance = [...document.querySelectorAll("#chanceSelection .selected")].map(e => e.textContent)[0];

    await axios.post("http://localhost:8082/api/tickets", { numbers, chanceNumber: chance }, { withCredentials: true });
    window.location.href = "tickets.html";
}
</script>

</body>
</html>
