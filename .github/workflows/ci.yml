# name: ðŸš€ CI/CD - Loto Tracker API (Vercel)

# on:
#   push:
#     branches:
#       - main
#       - develop
#   pull_request:
#     branches:
#       - main
#       - develop

# jobs:
#   build:
#     name: ðŸ— Build & Test API
#     runs-on: ubuntu-latest

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       - name: ðŸ”§ Setup JDK 21
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '21'
#           cache: 'maven'

#       - name: ðŸ“¦ Build with Maven (install dependencies)
#         run: mvn clean install -DskipTests

#       - name: ðŸ§ª Run Tests
#         run: mvn test

#     #   - name: ðŸ“Š Upload Test Coverage to Codecov
#     #     uses: codecov/codecov-action@v4
#     #     with:
#     #       token: ${{ secrets.CODECOV_TOKEN }}
#     #       files: target/site/jacoco/jacoco.xml
#     #       fail_ci_if_error: true
#     #       verbose: true

#   start-app:
#     name: ðŸš€ Start Spring Boot App
#     runs-on: ubuntu-latest
#     needs: build
#     if: github.ref == 'refs/heads/main'

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       - name: ðŸ”§ Setup JDK 21
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '21'

#       - name: ðŸš€ Run Spring Boot Application
#         run: mvn spring-boot:run &
#         env:
#           SPRING_PROFILES_ACTIVE: developpement

#       - name: ðŸ›‘ Wait for app to start (timeout 30s)
#         run: sleep 30

#       - name: ðŸ›  Test if app is running
#         run: curl --fail http://localhost:8082/api/hello || exit 1

#   deploy:
#     name: ðŸš€ Deploy to Vercel
#     runs-on: ubuntu-latest
#     needs: start-app
#     if: github.ref == 'refs/heads/main'

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       - name: âš¡ Install Vercel CLI
#         run: npm install -g vercel

#     #   - name: ðŸš€ Deploy to Vercel
#     #     run: vercel --prod --token=${{ secrets.VERCEL_TOKEN }}


# name: ðŸš€ CI/CD - Loto Tracker API (Vercel)

# on:
#   push:
#     branches:
#       - main
#       - develop
#   pull_request:
#     branches:
#       - main
#       - develop

# jobs:
#   build:
#     name: ðŸ— Build & Test API
#     runs-on: ubuntu-latest

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       - name: ðŸ”§ Setup JDK 21
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '21'
#           cache: 'maven'

#       - name: ðŸ“¦ Build with Maven (install dependencies)
#         run: mvn clean install -DskipTests

#       - name: ðŸ§ª Run Tests
#         run: mvn test --fail-at-end
#         continue-on-error: true

#       - name: ðŸ“Š Upload Test Results (JUnit)
#         uses: actions/upload-artifact@v3
#         with:
#           name: test-results
#           path: target/surefire-reports/*.xml

#   start-app:
#     name: ðŸš€ Start Spring Boot App
#     runs-on: ubuntu-latest
#     needs: build
#     if: github.ref == 'refs/heads/main'

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       - name: ðŸ”§ Setup JDK 21
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '21'

#       - name: ðŸš€ Run Spring Boot Application
#         run: mvn spring-boot:run &
#         env:
#           SPRING_PROFILES_ACTIVE: developpement

#       - name: ðŸ›‘ Wait for app to start (timeout 30s)
#         run: sleep 30

#       - name: ðŸ›  Test if app is running
#         run: curl --fail http://localhost:8082/api/hello || exit 1

#   deploy:
#     name: ðŸš€ Deploy to Vercel
#     runs-on: ubuntu-latest
#     needs: start-app
#     if: github.ref == 'refs/heads/main'

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       - name: âš¡ Install Vercel CLI
#         run: npm install -g vercel

#       # - name: ðŸš€ Deploy to Vercel
#       #   run: vercel --prod --token=${{ secrets.VERCEL_TOKEN }}


# name: ðŸš€ CI/CD - Loto Tracker API (Vercel)

# on:
#   push:
#     branches:
#       - main
#       - develop
#   pull_request:
#     branches:
#       - main
#       - develop

# jobs:
#   build:
#     name: ðŸ— Build & Test API (Docker)
#     runs-on: ubuntu-latest

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       - name: ðŸ”§ Setup JDK 21
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '21'
#           cache: 'maven'

#       - name: ðŸ³ Start Docker Containers
#         run: docker-compose up -d --build

#       - name: â³ Wait for services to be ready
#         run: |
#           echo "Waiting for services to start..."
#           sleep 30  # Ajuste en fonction du temps de dÃ©marrage de la BDD

#       - name: ðŸ“¦ Build with Maven (install dependencies)
#         run: mvn clean install -DskipTests

#       - name: ðŸ§ª Run Tests
#         run: mvn test

#       - name: ðŸ›‘ Stop & Clean Docker Containers
#         run: docker-compose down -v

#   start-app:
#     name: ðŸš€ Start Spring Boot App
#     runs-on: ubuntu-latest
#     needs: build
#     if: github.ref == 'refs/heads/main'

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       - name: ðŸ”§ Setup JDK 21
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '21'

#       - name: ðŸš€ Run Spring Boot Application
#         run: mvn spring-boot:run &
#         env:
#           SPRING_PROFILES_ACTIVE: developpement

#       - name: ðŸ›‘ Wait for app to start (timeout 30s)
#         run: sleep 30

#       - name: ðŸ›  Test if app is running
#         run: curl --fail http://localhost:8082/api/hello || exit 1

#   deploy:
#     name: ðŸš€ Deploy to Vercel
#     runs-on: ubuntu-latest
#     needs: start-app
#     if: github.ref == 'refs/heads/main'

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       - name: âš¡ Install Vercel CLI
#         run: npm install -g vercel

#     #   - name: ðŸš€ Deploy to Vercel
#     #     run: vercel --prod --token=${{ secrets.VERCEL_TOKEN }}


# name: ðŸš€ CI/CD - Loto Tracker API (Docker)

# on:
#   push:
#     branches:
#       - main
#       - develop
#   pull_request:
#     branches:
#       - main
#       - develop

# jobs:
#   build:
#     name: ðŸ— Build & Test API (Docker)
#     runs-on: ubuntu-latest

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # - name: ðŸ”§ Install Docker and Docker Compose
#       #   run: |
#       #     sudo apt update
#       #     sudo apt install -y docker.io docker-compose
#       #     sudo systemctl start docker
#       #     docker --version
#       #     docker-compose --version

#       - name: ðŸ”§ Install Docker and Docker Compose
#         run: |
#           sudo apt update
#           sudo apt install -y ca-certificates curl gnupg

#           # Ajouter la clÃ© GPG officielle de Docker
#           sudo install -m 0755 -d /etc/apt/keyrings
#           curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo tee /etc/apt/keyrings/docker.asc > /dev/null
#           sudo chmod a+r /etc/apt/keyrings/docker.asc

#           # Ajouter le dÃ©pÃ´t Docker officiel
#           echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

#           sudo apt update
#           sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

#           # VÃ©rifier les installations
#           docker --version
#           docker compose version


#       - name: ðŸ”§ Setup JDK 21
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '21'
#           cache: 'maven'

#       - name: ðŸ³ Start Docker Containers (MySQL & MongoDB)
#         run: docker compose up -d --build # âš ï¸ Note : "docker compose" sans tiret depuis v2 et non plus docker-compose

#       - name: â³ Wait for services to be ready
#         run: |
#           echo "Waiting for services to start..."
#           sleep 30  # Ajuste en fonction du temps de dÃ©marrage

#       - name: ðŸ“¦ Build with Maven (install dependencies)
#         run: mvn clean install -DskipTests

#       - name: ðŸ§ª Run Tests
#         run: mvn test

#       - name: ðŸ›‘ Stop & Clean Docker Containers
#         run: docker compose down -v

#   start-app:
#     name: ðŸš€ Start Spring Boot App
#     runs-on: ubuntu-latest
#     needs: build
#     if: github.ref == 'refs/heads/main'

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       - name: ðŸ”§ Setup JDK 21
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '21'

#       - name: ðŸš€ Run Spring Boot Application
#         run: mvn spring-boot:run &
#         env:
#           SPRING_PROFILES_ACTIVE: developpement

#       - name: ðŸ›‘ Wait for app to start (timeout 30s)
#         run: sleep 30

#       - name: ðŸ›  Test if app is running
#         run: curl --fail http://localhost:8082/api/hello || exit 1

#   deploy:
#     name: ðŸš€ Deploy to Vercel
#     runs-on: ubuntu-latest
#     needs: start-app
#     if: github.ref == 'refs/heads/main'

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       - name: âš¡ Install Vercel CLI
#         run: npm install -g vercel


# name: ðŸš€ CI/CD - Loto Tracker API (Test run Docker / Test install and run Spring-boot)

# on:
#   push:
#     branches:
#       - main
#       - develop
#   pull_request:
#     branches:
#       - main
#       - develop

# jobs:
#   build:
#     name: ðŸ— Build & Test API (Docker)
#     runs-on: ubuntu-latest

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Installer Docker et Docker Compose
#       - name: ðŸ”§ Install Docker and Docker Compose
#         run: |
#           sudo apt update
#           sudo apt install -y ca-certificates curl gnupg

#           # Ajouter la clÃ© GPG officielle de Docker
#           sudo install -m 0755 -d /etc/apt/keyrings
#           curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo tee /etc/apt/keyrings/docker.asc > /dev/null
#           sudo chmod a+r /etc/apt/keyrings/docker.asc

#           # Ajouter le dÃ©pÃ´t Docker officiel
#           echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

#           sudo apt update
#           sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

#           # VÃ©rifier les installations
#           docker --version
#           docker compose version

#       # Configurer JDK 21 pour Maven
#       - name: ðŸ”§ Setup JDK 21
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '21'
#           cache: 'maven'

#       # DÃ©marrer les conteneurs Docker pour MySQL et MongoDB
#       - name: ðŸ³ Start Docker Containers (MySQL & MongoDB)
#         run: docker compose up -d --build  # Note: "docker compose" sans tiret

#       # Attendre que les services soient prÃªts
#       - name: â³ Wait for services to be ready
#         run: |
#           echo "Waiting for services to start..."
#           sleep 30  # Ajuste en fonction du temps de dÃ©marrage

#       # Construire le projet avec Maven sans exÃ©cuter les tests
#       - name: ðŸ“¦ Build with Maven (install dependencies)
#         run: mvn clean install -DskipTests

#       # ExÃ©cuter les tests
#       - name: ðŸ§ª Run Tests
#         run: mvn test

#       # ArrÃªter et nettoyer les conteneurs Docker
#       - name: ðŸ›‘ Stop & Clean Docker Containers
#         run: docker compose down -v

#   start-app:
#     name: ðŸš€ Start Spring Boot App
#     runs-on: ubuntu-latest
#     needs: build
#     if: github.ref == 'refs/heads/main'

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Configurer JDK 21 pour Maven
#       - name: ðŸ”§ Setup JDK 21
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '21'

#       # Lancer l'application Spring Boot
#       - name: ðŸš€ Run Spring Boot Application
#         run: mvn spring-boot:run &
#         env:
#           SPRING_PROFILES_ACTIVE: developpement

#       # Attendre que l'application dÃ©marre
#       - name: ðŸ›‘ Wait for app to start (timeout 30s)
#         run: sleep 30

#       # Tester si l'API fonctionne
#       - name: ðŸ›  Test if app is running
#         run: curl --fail http://localhost:8082/api/hello || exit 1

#   deploy:
#     name: ðŸš€ Deploy to Vercel
#     runs-on: ubuntu-latest
#     needs: start-app
#     if: github.ref == 'refs/heads/main'

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Installer le CLI Vercel
#       - name: âš¡ Install Vercel CLI
#         run: npm install -g vercel


# name: ðŸš€ CI/CD - Loto Tracker API (Test run Docker / Test install and run Spring-boot)

# on:
#   push:
#     branches:
#       - main
#       - develop
#   pull_request:
#     branches:
#       - main
#       - develop

# jobs:
#   build:
#     name: ðŸ— Build & Test API (Docker)
#     runs-on: ubuntu-latest

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Installer Docker et Docker Compose
#       - name: ðŸ”§ Install Docker and Docker Compose
#         run: |
#           sudo apt update
#           sudo apt install -y ca-certificates curl gnupg

#           # Ajouter la clÃ© GPG officielle de Docker
#           sudo install -m 0755 -d /etc/apt/keyrings
#           curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo tee /etc/apt/keyrings/docker.asc > /dev/null
#           sudo chmod a+r /etc/apt/keyrings/docker.asc

#           # Ajouter le dÃ©pÃ´t Docker officiel
#           echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

#           sudo apt update
#           sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

#           # VÃ©rifier les installations
#           docker --version
#           docker compose version

#       # Configurer JDK 21 pour Maven
#       - name: ðŸ”§ Setup JDK 21
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '21'
#           cache: 'maven'

#       # DÃ©marrer les conteneurs Docker pour MySQL et MongoDB
#       - name: ðŸ³ Start Docker Containers (MySQL, MongoDB, API)
#         run: docker compose up -d --build

#       # Attendre le dÃ©marrage de l'API avec Swagger
#       - name: â³ Wait for API & Swagger UI to be ready
#         run: |
#           echo "Waiting for API..."
#           until curl --output /dev/null --silent --head --fail http://localhost:8082/swagger-ui.html; do
#             printf '.'
#             sleep 5
#           done
#           echo "âœ… Swagger UI is ready at http://localhost:8082/swagger-ui.html"

#       # Construire le projet avec Maven sans exÃ©cuter les tests
#       - name: ðŸ“¦ Build with Maven (install dependencies)
#         run: mvn clean install -DskipTests

#       # ExÃ©cuter les tests
#       - name: ðŸ§ª Run Tests
#         run: mvn test

#       # ArrÃªter et nettoyer les conteneurs Docker
#       - name: ðŸ›‘ Stop & Clean Docker Containers
#         run: docker compose down -v

#   deploy:
#     name: ðŸš€ Deploy to Vercel
#     runs-on: ubuntu-latest
#     needs: build
#     if: github.ref == 'refs/heads/main'

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Installer le CLI Vercel
#       - name: âš¡ Install Vercel CLI
#         run: npm install -g vercel

#       # DÃ©ployer l'API et Swagger UI sur Vercel
#       - name: ðŸš€ Deploy Swagger UI on Vercel
#         # run: vercel --prod --token=${{ secrets.VERCEL_TOKEN }}

# *********************************************fonctionne************************************************
# name: ðŸš€ CI/CD - Loto Tracker API (Test run Docker / Test install and run Spring-boot)

# on:
#   push:
#     branches:
#       - main
#       - develop
#   pull_request:
#     branches:
#       - main
#       - develop

# jobs:
#   build:
#     name: ðŸ— Build & Test API (Docker)
#     runs-on: ubuntu-latest

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Installer Docker et Docker Compose
#       - name: ðŸ”§ Install Docker and Docker Compose
#         run: |
#           sudo apt update
#           sudo apt install -y ca-certificates curl gnupg

#           # Ajouter la clÃ© GPG officielle de Docker
#           sudo install -m 0755 -d /etc/apt/keyrings
#           curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo tee /etc/apt/keyrings/docker.asc > /dev/null
#           sudo chmod a+r /etc/apt/keyrings/docker.asc

#           # Ajouter le dÃ©pÃ´t Docker officiel
#           echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

#           sudo apt update
#           sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

#           # VÃ©rifier les installations
#           docker --version
#           docker compose version

#       # Configurer JDK 21 pour Maven
#       - name: ðŸ”§ Setup JDK 21
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '21'
#           cache: 'maven'

#       # DÃ©marrer les conteneurs Docker pour MySQL et MongoDB
#       - name: ðŸ³ Start Docker Containers (MySQL & MongoDB)
#         run: docker compose up -d --build  # Note: "docker compose" sans tiret

#       # Attendre que les services soient prÃªts
#       - name: â³ Wait for services to be ready
#         run: |
#           echo "Waiting for services to start..."
#           sleep 30  # Ajuste en fonction du temps de dÃ©marrage

#       # Construire le projet avec Maven sans exÃ©cuter les tests
#       - name: ðŸ“¦ Build with Maven (install dependencies)
#         run: mvn clean install -DskipTests

#       # ExÃ©cuter les tests
#       - name: ðŸ§ª Run Tests
#         run: mvn test

#       # ArrÃªter et nettoyer les conteneurs Docker
#       - name: ðŸ›‘ Stop & Clean Docker Containers
#         run: docker compose down -v

#   start-app:
#     name: ðŸš€ Start Spring Boot App
#     runs-on: ubuntu-latest
#     needs: build
#     if: github.ref == 'refs/heads/main'

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Configurer JDK 21 pour Maven
#       - name: ðŸ”§ Setup JDK 21
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '21'

#       # Lancer l'application Spring Boot
#       - name: ðŸš€ Run Spring Boot Application
#         run: mvn spring-boot:run &
#         env:
#           SPRING_PROFILES_ACTIVE: developpement

#       # Attendre que l'application dÃ©marre
#       - name: ðŸ›‘ Wait for app to start (timeout 30s)
#         run: sleep 30

#       # Tester si l'API fonctionne
#       - name: ðŸ›  Test if app is running
#         run: curl --fail http://localhost:8082/api/hello || exit 1

#   deploy:
#     name: ðŸš€ Deploy to Vercel
#     runs-on: ubuntu-latest
#     needs: start-app
#     if: github.ref == 'refs/heads/main'

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Installer le CLI Vercel
#       - name: âš¡ Install Vercel CLI
#         run: npm install -g vercel


# name: ðŸš€ CI/CD - Loto Tracker API (Install and run springboot / Integration Tests with Docker, MongoDB, and SQLite)

# on:
#   push:
#     branches:
#       - main
#       - develop
#   pull_request:
#     branches:
#       - main
#       - develop

# jobs:
#   build:
#     name: ðŸ— Build API with Maven (before Docker)
#     runs-on: ubuntu-latest

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Installer JDK 21 pour Maven
#       - name: ðŸ”§ Setup JDK 21
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '21'
#           cache: 'maven'

#       # Construire le projet avec Maven avant Docker
#       - name: ðŸ“¦ Build with Maven (install dependencies)
#         run: mvn clean install -DskipTests

#       # ExÃ©cuter les tests unitaires Maven avant Docker
#       - name: ðŸ§ª Run Unit Tests with Maven
#         run: mvn test

#   test-integration:
#     name: ðŸ³ Docker & Integration Tests
#     runs-on: ubuntu-latest
#     needs: build

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Installer Docker et Docker Compose
#       - name: ðŸ”§ Install Docker and Docker Compose
#         run: |
#           sudo apt update
#           sudo apt install -y ca-certificates curl gnupg

#           # Ajouter la clÃ© GPG officielle de Docker
#           sudo install -m 0755 -d /etc/apt/keyrings
#           curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo tee /etc/apt/keyrings/docker.asc > /dev/null
#           sudo chmod a+r /etc/apt/keyrings/docker.asc

#           # Ajouter le dÃ©pÃ´t Docker officiel
#           echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

#           sudo apt update
#           sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

#           # VÃ©rifier les installations
#           docker --version
#           docker compose version

#       # DÃ©marrer les conteneurs Docker (MySQL, MongoDB, API)
#       - name: ðŸ³ Start Docker Containers (MySQL, SQLite & MongoDB)
#         run: docker compose up -d --build

#       # Attendre le dÃ©marrage de lâ€™API
#       - name: â³ Wait for API & Swagger UI to be ready
#         run: |
#           echo "Waiting for API..."
#           until curl --output /dev/null --silent --head --fail http://localhost:8082/swagger-ui.html; do
#             printf '.'
#             sleep 5
#           done
#           echo "âœ… API is ready!"

#       # ðŸ”‘ Authentification - Tester le login et rÃ©cupÃ©rer le token JWT
#       - name: ðŸ”‘ Login User & Retrieve JWT Token (login3)
#         id: login
#         run: |
#           JWT_TOKEN=$(curl -X POST "http://localhost:8082/api/auth/login3" \
#             -H "Content-Type: application/json" \
#             -d '{"email":"test4@hbnb.com","password":"user1234"}' \
#             -c cookies.txt | jq -r '.token')

#           if [ -z "$JWT_TOKEN" ]; then
#             echo "âŒ Login failed!"
#             exit 1
#           fi

#           echo "âœ… JWT Token retrieved!"
#           echo "::set-output name=jwt_token::$JWT_TOKEN"

#       # ðŸŽ« Tester la soumission dâ€™un ticket avec JWT
#       - name: ðŸŽ« Create Ticket
#         run: |
#           curl -X POST "http://localhost:8082/api/tickets" \
#             -H "Content-Type: application/json" \
#             -H "Authorization: Bearer ${{ steps.login.outputs.jwt_token }}" \
#             -d '{"numbers":[1,2,3,4,5],"luckyNumber":6}', "drawDate":"2025-03-12" \
#             -b cookies.txt

#       # ðŸ”„ Scraping des rÃ©sultats FDJ via le service Spring Boot
#       - name: ðŸ”„ Run Loto Scraper
#         run: |
#           curl -X GET "http://localhost:8082/api/loto/scrape"

#       # ðŸ† Calcul automatique des gains via lâ€™API
#       - name: ðŸ† Calculate Ticket Winnings
#         run: |
#           curl -X GET "http://localhost:8082/api/gains/calculate"

#       # ðŸ“… VÃ©rifier les tirages disponibles
#       - name: ðŸ” Get Available Draw Dates
#         run: |
#           curl -X GET "http://localhost:8082/api/tirages/dates"

#       # ðŸ“œ VÃ©rifier l'historique des rÃ©sultats
#       - name: ðŸ“œ Get Last 20 Lottery Results
#         run: |
#           curl -X GET "http://localhost:8082/api/historique/last20"

#       # ðŸ”’ Tester un endpoint protÃ©gÃ© avec JWT
#       - name: ðŸ”’ Get Authenticated User Info
#         run: |
#           curl -X GET "http://localhost:8082/api/auth/me" \
#             -H "Authorization: Bearer ${{ steps.login.outputs.jwt_token }}" \
#             -b cookies.txt

#       # ðŸ· VÃ©rifier le ticket soumis
#       - name: ðŸ“‘ Get Ticket Info
#         run: |
#           curl -X GET "http://localhost:8082/api/tickets"

#       # ArrÃªter et nettoyer les conteneurs Docker
#       - name: ðŸ›‘ Stop & Clean Docker Containers
#         run: docker compose down -v

#   deploy:
#     name: ðŸš€ Deploy to Vercel
#     runs-on: ubuntu-latest
#     needs: test-integration

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Installer le CLI Vercel
#       - name: âš¡ Install Vercel CLI
#         run: npm install -g vercel

#       # DÃ©ployer l'API et Swagger UI sur Vercel
#       - name: ðŸš€ Deploy Swagger UI on Vercel
#         # run: vercel --prod --token=${{ secrets.VERCEL_TOKEN }}

# name: ðŸš€ CI/CD - Loto Tracker API (Install and run Spring Boot / Integration Tests with Docker, MongoDB, and SQLite)

# on:
#   push:
#     branches:
#       - main
#       - develop
#   pull_request:
#     branches:
#       - main
#       - develop

# jobs:
#   build:
#     name: ðŸ— Build API with Maven (before Docker)
#     runs-on: ubuntu-latest

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Installer JDK 21 pour Maven
#       - name: ðŸ”§ Setup JDK 21
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '21'
#           cache: 'maven'

#       # Construire le projet avec Maven avant Docker
#       - name: ðŸ“¦ Build with Maven (install dependencies)
#         run: mvn clean install -DskipTests

#       # ExÃ©cuter les tests unitaires Maven avant Docker
#       - name: ðŸ§ª Run Unit Tests with Maven
#         run: mvn test

#   test-integration:
#     name: ðŸ³ Docker & Integration Tests
#     runs-on: ubuntu-latest
#     needs: build

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Installer Docker et Docker Compose
#       - name: ðŸ”§ Install Docker and Docker Compose
#         run: |
#           sudo apt update
#           sudo apt install -y ca-certificates curl gnupg
#           sudo install -m 0755 -d /etc/apt/keyrings
#           curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo tee /etc/apt/keyrings/docker.asc > /dev/null
#           sudo chmod a+r /etc/apt/keyrings/docker.asc
#           echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
#           sudo apt update
#           sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
#           docker --version
#           docker compose version

#       # DÃ©marrer les conteneurs Docker (MySQL, SQLite & MongoDB)
#       - name: ðŸ³ Start Docker Containers (MySQL, SQLite & MongoDB)
#         run: docker compose up -d --build

#       # Attendre que lâ€™API soit prÃªte (Swagger UI & Health Check)
#       - name: â³ Wait for API & Swagger UI to be ready
#         run: |
#           echo "Waiting for API..."
#           until curl --output /dev/null --silent --head --fail http://localhost:8082/api/hello; do
#             printf '.'
#             sleep 5
#           done
#           echo "âœ… API is ready!"

#       # ðŸ”‘ Authentification - Tester le login et rÃ©cupÃ©rer le token JWT
#       - name: ðŸ”‘ Login User & Retrieve JWT Token (login3)
#         id: login
#         run: |
#           JWT_TOKEN=$(curl -X POST "http://localhost:8082/api/auth/login3" \
#             -H "Content-Type: application/json" \
#             -d '{"email":"test4@hbnb.com","password":"user1234"}' \
#             -c cookies.txt | jq -r '.token')

#           if [ -z "$JWT_TOKEN" ]; then
#             echo "âŒ Login failed!"
#             exit 1
#           fi

#           echo "âœ… JWT Token retrieved!"
#           echo "::set-output name=jwt_token::$JWT_TOKEN"

#       # ðŸŽ« Tester la soumission dâ€™un ticket avec JWT
#       - name: ðŸŽ« Create Ticket
#         run: |
#           curl -X POST "http://localhost:8082/api/tickets" \
#             -H "Content-Type: application/json" \
#             -H "Authorization: Bearer ${{ steps.login.outputs.jwt_token }}" \
#             -d '{"numbers":[1,2,3,4,5],"luckyNumber":6, "drawDate":"2025-03-12"}' \
#             -b cookies.txt

#       # ðŸ”„ Scraping des rÃ©sultats FDJ via le service Spring Boot
#       - name: ðŸ”„ Run Loto Scraper
#         run: |
#           curl -X GET "http://localhost:8082/api/loto/scrape"

#       # ðŸ† Calcul automatique des gains via lâ€™API
#       - name: ðŸ† Calculate Ticket Winnings
#         run: |
#           curl -X GET "http://localhost:8082/api/gains/calculate"

#       # ðŸ“… VÃ©rifier les tirages disponibles
#       - name: ðŸ” Get Available Draw Dates
#         run: |
#           curl -X GET "http://localhost:8082/api/tirages/dates"

#       # ðŸ“œ VÃ©rifier l'historique des rÃ©sultats
#       - name: ðŸ“œ Get Last 20 Lottery Results
#         run: |
#           curl -X GET "http://localhost:8082/api/historique/last20"

#       # ðŸ”’ Tester un endpoint protÃ©gÃ© avec JWT
#       - name: ðŸ”’ Get Authenticated User Info
#         run: |
#           curl -X GET "http://localhost:8082/api/auth/me" \
#             -H "Authorization: Bearer ${{ steps.login.outputs.jwt_token }}" \
#             -b cookies.txt

#       # ðŸ· VÃ©rifier le ticket soumis
#       - name: ðŸ“‘ Get Ticket Info
#         run: |
#           curl -X GET "http://localhost:8082/api/tickets"

#       # ArrÃªter et nettoyer les conteneurs Docker
#       - name: ðŸ›‘ Stop & Clean Docker Containers
#         run: docker compose down -v

#   deploy:
#     name: ðŸš€ Deploy to Vercel
#     runs-on: ubuntu-latest
#     needs: test-integration

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Installer le CLI Vercel
#       - name: âš¡ Install Vercel CLI
#         run: npm install -g vercel

#       # DÃ©ployer l'API et Swagger UI sur Vercel
#       # - name: ðŸš€ Deploy Swagger UI on Vercel
#         # run: vercel --prod --token=${{ secrets.VERCEL_TOKEN }}


# name: ðŸš€ CI/CD - Loto Tracker API (Install and run Spring Boot / Integration Tests with Docker, MongoDB, and SQLite)

# on:
#   push:
#     branches:
#       - main
#       - develop
#   pull_request:
#     branches:
#       - main
#       - develop

# jobs:
#   build:
#     name: ðŸ— Build API with Maven (before Docker)
#     runs-on: ubuntu-latest

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Installer JDK 21 pour Maven
#       - name: ðŸ”§ Setup JDK 21
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '21'
#           cache: 'maven'

#       # Construire le projet avec Maven avant Docker
#       - name: ðŸ“¦ Build with Maven (install dependencies)
#         # run: mvn clean install -DskipTests
#         run: mvn clean install

#       # ExÃ©cuter les tests unitaires Maven avant Docker
#       - name: ðŸ§ª Run Unit Tests with Maven
#         run: mvn test

#       - name: ðŸ“¦ Run Maven (run)
#         # run: mvn clean install -DskipTests
#         run: mvn sprin-boot:run

#   test-integration:
#     name: ðŸ³ Docker & Integration Tests
#     runs-on: ubuntu-latest
#     needs: build

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Installer Docker et Docker Compose
#       - name: ðŸ”§ Install Docker and Docker Compose
#         run: |
#           sudo apt update
#           sudo apt install -y ca-certificates curl gnupg
#           sudo install -m 0755 -d /etc/apt/keyrings
#           curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo tee /etc/apt/keyrings/docker.asc > /dev/null
#           sudo chmod a+r /etc/apt/keyrings/docker.asc
#           echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
#           sudo apt update
#           sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
#           docker --version
#           docker compose version

#       # DÃ©marrer les conteneurs Docker (MySQL, SQLite & MongoDB)
#       - name: ðŸ³ Start Docker Containers (MySQL, SQLite & MongoDB)
#         run: docker compose up -d --build


#       # Attendre que lâ€™API soit prÃªte (Swagger UI & Health Check)
#       - name: â³ Wait for API & Swagger UI to be ready
#         run: |
#           echo "Waiting for API..."
#           until curl --output /dev/null --silent --head --fail http://localhost:8082/api/hello; do
#             printf '.'
#             sleep 5
#           done
#           echo "âœ… API is ready!"

#       # ðŸ”‘ Authentification - Tester le login et rÃ©cupÃ©rer le token JWT
#       - name: ðŸ”‘ Login User & Retrieve JWT Token (login3)
#         id: login
#         run: |
#           JWT_TOKEN=$(curl -s -X POST "http://localhost:8082/api/auth/login3" \
#             -H "Content-Type: application/json" \
#             -d '{"email":"test4@hbnb.com","password":"user1234"}' \
#             -c cookies.txt | jq -r '.token')

#           if [ -z "$JWT_TOKEN" ]; then
#             echo "âŒ Login failed!"
#             exit 1
#           fi

#           echo "âœ… JWT Token retrieved!"
#           echo "JWT_TOKEN=$JWT_TOKEN" >> $GITHUB_ENV



#       # ðŸŽ« Tester la soumission dâ€™un ticket avec JWT
#       - name: ðŸŽ« Create Ticket
#         run: |
#           response=$(curl -s -o response.json -w "%{http_code}" -X POST "http://localhost:8082/api/tickets" \
#             -H "Content-Type: application/json" \
#             -H "Authorization: Bearer $JWT_TOKEN" \
#             -d '{"numbers":[1,2,3,4,5],"luckyNumber":6, "drawDate":"2025-03-12"}' \
#             -b cookies.txt)

#           if [ "$response" -eq 201 ]; then
#             echo "âœ… Ticket successfully created!"
#           else
#             echo "âŒ Failed to create ticket. HTTP Code: $response"
#             exit 1
#           fi


#       # ðŸ”„ Scraping des rÃ©sultats FDJ via le service Spring Boot
#       - name: ðŸ”„ Run Loto Scraper
#         run: |
#           response=$(curl -s -o /dev/null -w "%{http_code}" -X GET "http://localhost:8082/api/loto/scrape")
#           if [ "$response" -eq 200 ]; then
#             echo "âœ… Scraping successfully started!"
#           else
#             echo "âŒ Scraping failed. HTTP Code: $response"
#             exit 1
#           fi

#       # ðŸ† Calcul automatique des gains via lâ€™API
#       - name: ðŸ† Calculate Ticket Winnings
#         run: |
#           response=$(curl -s -o /dev/null -w "%{http_code}" -X GET "http://localhost:8082/api/gains/calculate")
#           if [ "$response" -eq 200 ]; then
#             echo "âœ… Ticket winnings calculated!"
#           else
#             echo "âŒ Ticket winnings calculation failed. HTTP Code: $response"
#             exit 1
#           fi

#       # ðŸ“… VÃ©rifier les tirages disponibles
#       - name: ðŸ” Get Available Draw Dates
#         run: |
#           response=$(curl -s -o response.json -w "%{http_code}" -X GET "http://localhost:8082/api/tirages/dates")
#           if [ "$response" -eq 200 ]; then
#             echo "âœ… Available draw dates retrieved!"
#           else
#             echo "âŒ Failed to retrieve draw dates. HTTP Code: $response"
#             exit 1
#           fi

#       # ðŸ“œ VÃ©rifier l'historique des rÃ©sultats
#       - name: ðŸ“œ Get Last 20 Lottery Results
#         run: |
#           response=$(curl -s -o response.json -w "%{http_code}" -X GET "http://localhost:8082/api/historique/last20")
#           if [ "$response" -eq 200 ]; then
#             echo "âœ… Last 20 lottery results retrieved!"
#           else
#             echo "âŒ Failed to retrieve lottery results. HTTP Code: $response"
#             exit 1
#           fi

#       # ðŸ”’ Tester un endpoint protÃ©gÃ© avec JWT
#       - name: ðŸ”’ Get Authenticated User Info
#         run: |
#           response=$(curl -s -o response.json -w "%{http_code}" -X GET "http://localhost:8082/api/auth/me" \
#             -H "Authorization: Bearer $JWT_TOKEN" \
#             -b cookies.txt)

#           if [ "$response" -eq 200 ]; then
#             echo "âœ… Authenticated user info retrieved!"
#           else
#             echo "âŒ Failed to retrieve authenticated user info. HTTP Code: $response"
#             exit 1
#           fi


#       # ðŸ· VÃ©rifier le ticket soumis
#       - name: ðŸ“‘ Get Ticket Info
#         run: |
#           response=$(curl -s -o response.json -w "%{http_code}" -X GET "http://localhost:8082/api/tickets")
#           if [ "$response" -eq 200 ]; then
#             echo "âœ… Ticket info retrieved!"
#           else
#             echo "âŒ Failed to retrieve ticket info. HTTP Code: $response"
#             exit 1
#           fi


#       # ArrÃªter et nettoyer les conteneurs Docker
#       - name: ðŸ›‘ Stop & Clean Docker Containers
#         run: docker compose down -v

#   deploy:
#     name: ðŸš€ Deploy to Vercel
#     runs-on: ubuntu-latest
#     needs: test-integration

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Installer le CLI Vercel
#       - name: âš¡ Install Vercel CLI
#         run: npm install -g vercel

#       # DÃ©ployer l'API et Swagger UI sur Vercel
#       # - name: ðŸš€ Deploy Swagger UI on Vercel
#         # run: vercel --prod --token=${{ secrets.VERCEL_TOKEN }}


# name: ðŸš€ CI/CD - Loto Tracker API (Install and run Spring Boot / Integration Tests with Docker, MongoDB, and SQLite)

# on:
#   push:
#     branches:
#       - main
#       - develop
#   pull_request:
#     branches:
#       - main
#       - develop

# jobs:
#   build:
#     name: ðŸ— Build API with Maven (before Docker)
#     runs-on: ubuntu-latest

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Installer JDK 21 pour Maven
#       - name: ðŸ”§ Setup JDK 21
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '21'
#           cache: 'maven'

#       # Construire le projet avec Maven avant Docker
#       - name: ðŸ“¦ Build with Maven (install dependencies)
#         # run: mvn clean install -DskipTests
#         run: mvn clean install

#       # ExÃ©cuter les tests unitaires Maven avant Docker
#       - name: ðŸ§ª Run Unit Tests with Maven
#         run: mvn test

#       # - name: ðŸ“¦ Run Maven (run)
#       #   # run: mvn clean install -DskipTests
#       #   run: mvn spring-boot:run

#   test-integration:
#     name: ðŸ³ Docker & Integration Tests
#     runs-on: ubuntu-latest
#     needs: build

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Installer Docker et Docker Compose
#       - name: ðŸ”§ Install Docker and Docker Compose
#         run: |
#           sudo apt update
#           sudo apt install -y ca-certificates curl gnupg
#           sudo install -m 0755 -d /etc/apt/keyrings
#           curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo tee /etc/apt/keyrings/docker.asc > /dev/null
#           sudo chmod a+r /etc/apt/keyrings/docker.asc
#           echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
#           sudo apt update
#           sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
#           docker --version
#           docker compose version

#       # DÃ©marrer les conteneurs Docker (MySQL, SQLite & MongoDB)
#       - name: ðŸ³ Start Docker Containers (MySQL, SQLite & MongoDB)
#         run: docker compose up -d --build


#       # Attendre que lâ€™API soit prÃªte (Swagger UI & Health Check)
#       - name: â³ Wait for API & Swagger UI to be ready
#         run: |
#           echo "Waiting for API..."
#           until curl --output /dev/null --silent --head --fail http://localhost:8082/api/hello; do
#             printf '.'
#             sleep 5
#           done
#           echo "âœ… API is ready!"

#       # ðŸ”‘ Authentification - Tester le login et rÃ©cupÃ©rer le token JWT
#       - name: ðŸ”‘ Login User & Retrieve JWT Token (login3)
#         id: login
#         run: |
#           JWT_TOKEN=$(curl -s -X POST "http://localhost:8082/api/auth/login3" \
#             -H "Content-Type: application/json" \
#             -d '{"email":"test4@hbnb.com","password":"user1234"}' \
#             -c cookies.txt | jq -r '.token')

#           if [ -z "$JWT_TOKEN" ]; then
#             echo "âŒ Login failed!"
#             exit 1
#           fi

#           echo "âœ… JWT Token retrieved!"
#           echo "JWT_TOKEN=$JWT_TOKEN" >> $GITHUB_ENV

#       - name: ðŸ” Display JWT Token (Debug)
#         run: |
#           echo "ðŸ” JWT Token: $JWT_TOKEN"






#       # ðŸŽ« Tester la soumission dâ€™un ticket avec JWT
#       - name: ðŸŽ« Create Ticket
#         run: |
#           response=$(curl -s -o response.json -w "%{http_code}" -X POST "http://localhost:8082/api/tickets" \
#             -H "Content-Type: application/json" \
#             -H "Authorization: Bearer $JWT_TOKEN" \
#             -d '{"numbers":[1,2,3,4,5],"luckyNumber":6, "drawDate":"2025-03-12"}' \
#             -b cookies.txt)

#           if [ "$response" -eq 201 ]; then
#             echo "âœ… Ticket successfully created!"
#           else
#             echo "âŒ Failed to create ticket. HTTP Code: $response"
#             exit 1
#           fi



#       # ðŸ”„ Scraping des rÃ©sultats FDJ via le service Spring Boot
#       - name: ðŸ”„ Run Loto Scraper
#         run: |
#           response=$(curl -s -o /dev/null -w "%{http_code}" -X GET "http://localhost:8082/api/loto/scrape")
#           if [ "$response" -eq 200 ]; then
#             echo "âœ… Scraping successfully started!"
#           else
#             echo "âŒ Scraping failed. HTTP Code: $response"
#             exit 1
#           fi

#       # ðŸ† Calcul automatique des gains via lâ€™API
#       - name: ðŸ† Calculate Ticket Winnings
#         run: |
#           response=$(curl -s -o /dev/null -w "%{http_code}" -X GET "http://localhost:8082/api/gains/calculate")
#           if [ "$response" -eq 200 ]; then
#             echo "âœ… Ticket winnings calculated!"
#           else
#             echo "âŒ Ticket winnings calculation failed. HTTP Code: $response"
#             exit 1
#           fi

#       # ðŸ“… VÃ©rifier les tirages disponibles
#       - name: ðŸ” Get Available Draw Dates
#         run: |
#           response=$(curl -s -o response.json -w "%{http_code}" -X GET "http://localhost:8082/api/tirages/dates")
#           if [ "$response" -eq 200 ]; then
#             echo "âœ… Available draw dates retrieved!"
#           else
#             echo "âŒ Failed to retrieve draw dates. HTTP Code: $response"
#             exit 1
#           fi

#       # ðŸ“œ VÃ©rifier l'historique des rÃ©sultats
#       - name: ðŸ“œ Get Last 20 Lottery Results
#         run: |
#           response=$(curl -s -o response.json -w "%{http_code}" -X GET "http://localhost:8082/api/historique/last20")
#           if [ "$response" -eq 200 ]; then
#             echo "âœ… Last 20 lottery results retrieved!"
#           else
#             echo "âŒ Failed to retrieve lottery results. HTTP Code: $response"
#             exit 1
#           fi

#       # ðŸ”’ Tester un endpoint protÃ©gÃ© avec JWT
#       - name: ðŸ”’ Get Authenticated User Info
#         run: |
#           response=$(curl -s -o response.json -w "%{http_code}" -X GET "http://localhost:8082/api/auth/me" \
#             -H "Authorization: Bearer $JWT_TOKEN" \
#             -b cookies.txt)

#           if [ "$response" -eq 200 ]; then
#             echo "âœ… Authenticated user info retrieved!"
#           else
#             echo "âŒ Failed to retrieve authenticated user info. HTTP Code: $response"
#             exit 1
#           fi


#       # ðŸ· VÃ©rifier le ticket soumis
#       - name: ðŸ“‘ Get Ticket Info
#         run: |
#           response=$(curl -s -o response.json -w "%{http_code}" -X GET "http://localhost:8082/api/tickets")
#           if [ "$response" -eq 200 ]; then
#             echo "âœ… Ticket info retrieved!"
#           else
#             echo "âŒ Failed to retrieve ticket info. HTTP Code: $response"
#             exit 1
#           fi


#       # ArrÃªter et nettoyer les conteneurs Docker
#       - name: ðŸ›‘ Stop & Clean Docker Containers
#         run: docker compose down -v

#   deploy:
#     name: ðŸš€ Deploy to Vercel
#     runs-on: ubuntu-latest
#     needs: test-integration

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       # Installer le CLI Vercel
#       - name: âš¡ Install Vercel CLI
#         run: npm install -g vercel

#       # DÃ©ployer l'API et Swagger UI sur Vercel
#       # - name: ðŸš€ Deploy Swagger UI on Vercel
#         # run: vercel --prod --token=${{ secrets.VERCEL_TOKEN }}

# name: ðŸš€ CI/CD - Loto Tracker API (Install and run Spring Boot / Integration Tests with Docker, MongoDB, and SQLite)

# on:
#   push:
#     branches:
#       - main
#       - develop
#       - '**'  # ExÃ©cute sur toutes les branches
#   pull_request:
#     branches:
#       - main
#       - develop
#       - '**'  # ExÃ©cute sur toutes les branches

# jobs:
#   build:
#     name: ðŸ— Build API with Maven (before Docker)
#     runs-on: ubuntu-latest

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       - name: ðŸ”§ Setup JDK 21
#         uses: actions/setup-java@v3
#         with:
#           distribution: 'temurin'
#           java-version: '21'
#           cache: 'maven'

#       - name: ðŸ“¦ Build with Maven (install dependencies)
#         run: mvn clean install

#       - name: ðŸ§ª Run Unit Tests with Maven
#         run: mvn test

#   test-integration:
#     name: ðŸ³ Docker & Integration Tests
#     runs-on: ubuntu-latest
#     needs: build

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       - name: ðŸ”§ Install Docker and Docker Compose
#         run: |
#           sudo apt update
#           sudo apt install -y ca-certificates curl gnupg
#           sudo install -m 0755 -d /etc/apt/keyrings
#           curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo tee /etc/apt/keyrings/docker.asc > /dev/null
#           sudo chmod a+r /etc/apt/keyrings/docker.asc
#           echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
#           sudo apt update
#           sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
#           docker --version
#           docker compose version

#       - name: ðŸ³ Start Docker Containers (MySQL, SQLite & MongoDB)
#         run: docker compose up -d --build

#       - name: â³ Wait for API & Swagger UI to be ready
#         run: |
#           echo "Waiting for API..."
#           until curl --output /dev/null --silent --head --fail http://localhost:8082/api/hello; do
#             printf '.'
#             sleep 5
#           done
#           echo "âœ… API is ready!"

#       - name: ðŸ”‘ Login User & Retrieve JWT Token (login3)
#         id: login
#         run: |
#           JWT_TOKEN=$(curl -s -X POST "http://localhost:8082/api/auth/login3" \
#             -H "Content-Type: application/json" \
#             -d '{"email":"test4@hbnb.com","password":"user1234"}' \
#             -c cookies.txt | jq -r '.token')

#           if [ -z "$JWT_TOKEN" ]; then
#             echo "âŒ Login failed!"
#             exit 1
#           fi

#           echo "âœ… JWT Token retrieved!"
#           echo "JWT_TOKEN=$JWT_TOKEN" >> $GITHUB_ENV
#           echo "::add-mask::$JWT_TOKEN"  # Masquer le token dans les logs GitHub Actions

#       - name: ðŸ” Display JWT Token (Debug)
#         run: |
#           echo "ðŸ” JWT Token retrieved successfully!"

#       - name: ðŸŽ« Create Ticket
#         run: |
#           response=$(curl -s -o response.json -w "%{http_code}" -X POST "http://localhost:8082/api/tickets" \
#             -H "Content-Type: application/json" \
#             -H "Authorization: Bearer ${{ env.JWT_TOKEN }}" \
#             -d '{"numbers":[1,2,3,4,5],"luckyNumber":6, "drawDate":"2025-03-12"}' \
#             -b cookies.txt)

#           cat response.json  # Debug: afficher la rÃ©ponse JSON reÃ§ue

#           if [ "$response" -eq 201 ]; then
#             echo "âœ… Ticket successfully created!"
#           else
#             echo "âŒ Failed to create ticket. HTTP Code: $response"
#             exit 1
#           fi

#       - name: ðŸ”„ Run Loto Scraper
#         run: |
#           response=$(curl -s -o /dev/null -w "%{http_code}" -X GET "http://localhost:8082/api/loto/scrape")
#           if [ "$response" -eq 200 ]; then
#             echo "âœ… Scraping successfully started!"
#           else
#             echo "âŒ Scraping failed. HTTP Code: $response"
#             exit 1
#           fi

#       - name: ðŸ† Calculate Ticket Winnings
#         run: |
#           response=$(curl -s -o /dev/null -w "%{http_code}" -X GET "http://localhost:8082/api/gains/calculate")
#           if [ "$response" -eq 200 ]; then
#             echo "âœ… Ticket winnings calculated!"
#           else
#             echo "âŒ Ticket winnings calculation failed. HTTP Code: $response"
#             exit 1
#           fi

#       - name: ðŸ“‘ Get Ticket Info
#         run: |
#           response=$(curl -s -o response.json -w "%{http_code}" -X GET "http://localhost:8082/api/tickets")
#           if [ "$response" -eq 200 ]; then
#             echo "âœ… Ticket info retrieved!"
#           else
#             echo "âŒ Failed to retrieve ticket info. HTTP Code: $response"
#             exit 1
#           fi

#       - name: ðŸ›‘ Stop & Clean Docker Containers
#         run: docker compose down -v

#   deploy:
#     name: ðŸš€ Deploy to Vercel
#     runs-on: ubuntu-latest
#     needs: test-integration

#     steps:
#       - name: ðŸ›  Checkout code
#         uses: actions/checkout@v4

#       - name: âš¡ Install Vercel CLI
#         run: npm install -g vercel

#       # DÃ©ployer sur Vercel
#       # - name: ðŸš€ Deploy to Vercel
#         # run: vercel --prod --token=${{ secrets.VERCEL_TOKEN }}


name: ðŸš€ CI/CD - Loto Tracker API (Install and run Spring Boot / Integration Tests with Docker, MongoDB, and SQLite)

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop

jobs:
  build:
    name: ðŸ— Build API with Maven (before Docker)
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ›  Checkout code
        uses: actions/checkout@v4

      - name: ðŸ”§ Setup JDK 21
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '21'
          cache: 'maven'

      - name: ðŸ“¦ Build with Maven (install dependencies)
        run: mvn clean install

      - name: ðŸ§ª Run Unit Tests with Maven
        run: mvn test

  test-integration:
    name: ðŸ³ Docker & Integration Tests
    runs-on: ubuntu-latest
    needs: build

    steps:
      - name: ðŸ›  Checkout code
        uses: actions/checkout@v4

      - name: ðŸ”§ Install Docker and Docker Compose
        run: |
          sudo apt update
          sudo apt install -y ca-certificates curl gnupg
          sudo install -m 0755 -d /etc/apt/keyrings
          curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo tee /etc/apt/keyrings/docker.asc > /dev/null
          sudo chmod a+r /etc/apt/keyrings/docker.asc
          echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
          sudo apt update
          sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
          docker --version
          docker compose version

      - name: ðŸ³ Start Docker Containers (MySQL, SQLite & MongoDB)
        run: docker compose up -d --build

      - name: â³ Wait for API & Swagger UI to be ready
        run: |
          echo "Waiting for API..."
          until curl --output /dev/null --silent --head --fail http://localhost:8082/api/hello; do
            printf '.'
            sleep 5
          done
          echo "âœ… API is ready!"

      - name: ðŸ”‘ Login User & Retrieve JWT Token
        id: login
        run: |
          response=$(curl -s -X POST "http://localhost:8082/api/auth/login3" \
            -H "Content-Type: application/json" \
            -d '{"email":"test4@hbnb.com","password":"user1234"}' \
            -c cookies.txt)

          echo "ðŸ” Login response: $response"  # Debug

          JWT_TOKEN=$(echo "$response" | jq -r '.token')

          if [ -z "$JWT_TOKEN" ] || [ "$JWT_TOKEN" == "null" ]; then
            echo "âŒ Login failed!"
            exit 1
          fi

          echo "âœ… JWT Token retrieved!"
          echo "::set-output name=jwt_token::$JWT_TOKEN"

      - name: ðŸŽ« Create Ticket
        run: |
          echo "ðŸ” Using JWT Token: ${{ steps.login.outputs.jwt_token }}"  # Debug

          response=$(curl -s -o response.json -w "%{http_code}" -X POST "http://localhost:8082/api/tickets" \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer ${{ steps.login.outputs.jwt_token }}" \
            -d '{"numbers":[1,2,3,4,5],"luckyNumber":6, "drawDate":"2025-03-12"}' \
            -b cookies.txt)

          cat response.json  # Debug

          if [ "$response" -eq 201 ]; then
            echo "âœ… Ticket successfully created!"
          else
            echo "âŒ Failed to create ticket. HTTP Code: $response"
            exit 1
          fi

      - name: ðŸ”„ Run Loto Scraper
        run: |
          response=$(curl -s -o /dev/null -w "%{http_code}" -X GET "http://localhost:8082/api/loto/scrape")
          if [ "$response" -eq 200 ]; then
            echo "âœ… Scraping successfully started!"
          else
            echo "âŒ Scraping failed. HTTP Code: $response"
            exit 1
          fi

      - name: ðŸ† Calculate Ticket Winnings
        run: |
          response=$(curl -s -o /dev/null -w "%{http_code}" -X GET "http://localhost:8082/api/gains/calculate")
          if [ "$response" -eq 200 ]; then
            echo "âœ… Ticket winnings calculated!"
          else
            echo "âŒ Ticket winnings calculation failed. HTTP Code: $response"
            exit 1
          fi

      - name: ðŸ” Get Available Draw Dates
        run: |
          response=$(curl -s -o response.json -w "%{http_code}" -X GET "http://localhost:8082/api/tirages/dates")
          if [ "$response" -eq 200 ]; then
            echo "âœ… Available draw dates retrieved!"
          else
            echo "âŒ Failed to retrieve draw dates. HTTP Code: $response"
            exit 1
          fi

      - name: ðŸ“œ Get Last 20 Lottery Results
        run: |
          response=$(curl -s -o response.json -w "%{http_code}" -X GET "http://localhost:8082/api/historique/last20")
          if [ "$response" -eq 200 ]; then
            echo "âœ… Last 20 lottery results retrieved!"
          else
            echo "âŒ Failed to retrieve lottery results. HTTP Code: $response"
            exit 1
          fi

      - name: ðŸ”’ Get Authenticated User Info
        run: |
          response=$(curl -s -o response.json -w "%{http_code}" -X GET "http://localhost:8082/api/auth/me" \
            -H "Authorization: Bearer ${{ steps.login.outputs.jwt_token }}" \
            -b cookies.txt)

          if [ "$response" -eq 200 ]; then
            echo "âœ… Authenticated user info retrieved!"
          else
            echo "âŒ Failed to retrieve authenticated user info. HTTP Code: $response"
            exit 1
          fi

      - name: ðŸ“‘ Get Ticket Info
        run: |
          response=$(curl -s -o response.json -w "%{http_code}" -X GET "http://localhost:8082/api/tickets")
          if [ "$response" -eq 200 ]; then
            echo "âœ… Ticket info retrieved!"
          else
            echo "âŒ Failed to retrieve ticket info. HTTP Code: $response"
            exit 1
          fi

      - name: ðŸ›‘ Stop & Clean Docker Containers
        run: docker compose down -v

  deploy:
    name: ðŸš€ Deploy to Vercel
    runs-on: ubuntu-latest
    needs: test-integration

    steps:
      - name: ðŸ›  Checkout code
        uses: actions/checkout@v4

      - name: âš¡ Install Vercel CLI
        run: npm install -g vercel

      # - name: ðŸš€ Deploy Swagger UI on Vercel
      #   run: vercel --prod --token=${{ secrets.VERCEL_TOKEN }}

